@{
    this.ViewBag.Title = "GroupChat";
}


@*<div class="container">
    <div id="message-holder" class="mt-3 d-flex justify-content-start">
        <h4>Message</h4>
        <input class="w-75 ml-4 pl-3" type="text" id="messageInput" placeholder="Message..." />
        <button id="sendButton" class="ml-4 btn btn-dark btn-lg">Send</button>
    </div>
    <hr style="height: 5px;" class="bg-dark" />
    <div id="messagesList" style="font-size: 28px;">
    </div>
</div>*@

<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->

<div class="container">
    <div class="row">
        <div class="col-md-5">
            <div class="panel panel-primary">
                <div class="panel-heading" id="accordion">
                    <span class="glyphicon glyphicon-comment"></span> Chat
                    <div class="btn-group pull-right">
                        <a type="button" class="btn btn-default btn-xs" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </a>
                    </div>
                </div>
                <div class="panel-collapse collapse" id="collapseOne">
                    <div class="panel-body">
                        <ul class="chat">
                            <li class="left clearfix">
                                
                               <div class="chat-body clearfix">
                                    <div class="header">
                                        <strong class="primary-font"></strong> <small class="pull-right text-muted">
                                 <span class="glyphicon glyphicon-time"></span>  @DateTime.Now
                                        </small>
                                    </div>
                                    <p id="messagesList">
                                       
                                    </p>
                                </div>
                            </li>
                                                     
                            
                        </ul>
                    </div>
                    <div id="messagesList" class="panel-footer">
                        <div id="message-holder" class="input-group">
                            <input id="messageInput" type="text" class="form-control input-sm" placeholder="Type your message here..." />
                            <span class="input-group-btn">
                                <button id="sendButton" class="btn btn-warning btn-sm">
                                    Send
                                </button>
                            </span>
                        </div>
                       
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        var connection =
            new signalR.HubConnectionBuilder()
                .withUrl("/chat")
                .build();
        connection.on("NewMessage",
            function (message) {
                var chatInfo = `<div>[${message.user}] ${escapeHtml(message.text)}</div>`;
                $("#messagesList").append(chatInfo);
            });
        $("#sendButton").click(function () {
            var message = $("#messageInput").val();
            connection.invoke("Send", message);
            $("#messageInput").val("");
        });
        connection.start().catch(function (err) {
            return console.error(err.toString());
        });
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
}